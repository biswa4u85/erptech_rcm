[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Schedule Master",
  "enabled": 1,
  "modified": "2024-03-08 19:40:14.654202",
  "module": "Rcm Pro",
  "name": "Schedule Master",
  "script": "frappe.ui.form.on('Schedule Master', {\n    refresh(frm) {\n        if (frm.doc.docstatus === 1) {\n            frm.add_custom_button(__('Delivery Note'), function () {\n                frappe.new_doc('Delivery Note', frm.doc);\n            }, __(\"Create\"));\n        }\n    },\n    onload(frm) {\n        if (frm.doc.docstatus === 0) {\n            frm.set_value(\"entry_by\", frappe.session.user);\n        }\n        if (frm.doc.status === 'Draft') {\n            frm.set_value(\"supervisor\", frappe.session.user);\n        }\n    },\n    order_no: async function (frm) {\n        let orderDetail = await frappe.db.get_value(\"Sales Order\", frm.doc.order_no, [\"customer\", \"custom_site_name\", \"total_qty\", \"total\"]);\n        if (orderDetail.message) {\n            frm.set_value('party_name', orderDetail.message.customer);\n            frm.set_value('site_name', orderDetail.message.custom_site_name);\n            frm.set_value('remaining_qty', orderDetail.message.total_qty);\n            frm.set_value('grade_name', \"\");\n            frm.set_value('rmc_rate', orderDetail.message.total);\n        }\n        let deliveryNotes = await frappe.db.get_list(\"Delivery Note\", {\n            fields: [\"custom_grand_total_qty\"],\n            filters: { custom_sales_order_no: frm.doc.order_no },\n            limit: 100,\n        });\n        console.log(deliveryNotes)\n    },\n    schedule_qty: async function (frm) {\n        let orderDetail = await frappe.db.get_value(\"Sales Order\", frm.doc.order_no, [\"total_qty\"]);\n        if (frm.doc.schedule_qty < orderDetail.message.total_qty) {\n            frm.set_value('remaining_qty', orderDetail.message.total_qty - frm.doc.schedule_qty);\n        }\n    },\n    validate: function (frm) {\n        if (frm.doc.remaining_qty < frm.doc.schedule_qty) {\n            frappe.msgprint(__(\"You can not add more then remaining qty\"));\n            frappe.validated = false;\n        }\n    },\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Order",
  "enabled": 1,
  "modified": "2024-03-08 18:55:52.364116",
  "module": "Rcm Pro",
  "name": "Sales Order",
  "script": "frappe.ui.form.on('Sales Order', {\n    refresh(frm) {\n        frm.add_custom_button(__('Schedule Master'), function () {\n            frappe.new_doc('Schedule Master', frm.doc);\n        }, __(\"Create\"));\n        setTimeout(() => {\n            frm.remove_custom_button('Pick List', 'Create');\n            frm.remove_custom_button('Work Order', 'Create');\n            frm.remove_custom_button('Material Request', 'Create');\n            frm.remove_custom_button('Request for Raw Materials', 'Create');\n            frm.remove_custom_button('Purchase Order', 'Create');\n            frm.remove_custom_button('Project', 'Create');\n            frm.remove_custom_button('Payment Request', 'Create');\n        }, 200);\n        const elementsToDelete = document.querySelectorAll('[data-doctype=\"Pick List\"], [data-doctype=\"Maintenance Visit\"], [data-doctype=\"Work Order\"], [data-doctype=\"Material Request\"], [data-doctype=\"Purchase Order\"], [data-doctype=\"Project\"]');\n        elementsToDelete.forEach(element => {\n            element.remove();\n        });\n    },\n    onload(frm) {\n        if (frm.doc.docstatus === 0) {\n            frm.set_value(\"custom_entry_by\", frappe.session.user);\n        }\n        if (frm.doc.status === 'Draft') {\n            frm.set_value(\"custom_authorozed_by\", frappe.session.user);\n        }\n    },\n    customer: async function (frm) {\n        frm.set_value('custom_buyer_name', frm.doc.customer);\n    },\n    custom_buyer_name: async function (frm) {\n        let address = await frappe.db.get_value(\"Customer\", frm.doc.custom_buyer_name, [\"*\"]);\n        if (address?.message) {\n            frm.set_value('shipping_address_name', address.message.customer_primary_address);\n        }\n    },\n    custom_site_name: async function (frm) {\n        let address = await frappe.db.get_value(\"Job Site Master\", frm.doc.custom_site_name, [\"address\"]);\n        if (address?.message) {\n            frm.set_value('dispatch_address_name', address.message.address);\n        }\n    }\n})",
  "view": "Form"
 }
]